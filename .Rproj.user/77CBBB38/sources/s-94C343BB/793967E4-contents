---
title: "R Notebook"
output: html_notebook
---

Going to look at a randomly chosen MAP data file to see what can be done with the analysis

```{r}
library(tidyverse)
library(here)
library(zoo)
```

Create table, rename, delete first 5 rows ("The first 3 nucleotide positions of the genome is having some weird numbers but after that all are real. I am not sure why is this happening. I would recommend to ignore the first 5 positions of the genome" - Sandeep)
```{r}
S26C_MAP <- read.table("~/Box/TIMOTHY_READ/DATA/2020-Chlamydia_Agilent_project/MAP_ASR/26C_MAP.txt", row.names = NULL, sep = "\t")
colnames(S26C_MAP) <- c("Position","Refnt","Coverage","E","E.1","Aa","Gg","Cc","Tt","Ref_cov","Map_value")
S26C_MAP <- S26C_MAP[-c(1,2,3,4,5),]
S26C_MAP$Position <- as.integer(S26C_MAP$Position)
# find all places where the numbers add up. The "regular" column means that the ref coverage + all minor bases == total coverage
S26C_MAP <- S26C_MAP %>% 
  select(-E,-E.1) %>%
  mutate(regular = ifelse(Ref_cov + Aa + Gg + Cc + Tt == Coverage,1,0)) %>%
  mutate(minor_counts = Aa + Gg + Cc + Tt)
```


```{r}
S26C_MAP %>% tally() 
S26C_MAP %>% 
  filter(regular == 1) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 1) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 1 | regular == 1) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 1 | regular == 1 & minor_counts == 0) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 1 & minor_counts > 0) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 1 & regular == 0) %>%
  tally()
S26C_MAP %>% 
  filter(Map_value == 0) %>%
  tally()
```


Rolling mean of coverage plot using ```rollmean``` function
```{r}
ggplot(S26C_MAP, aes(Position, Coverage)) + 
  geom_line(aes(y=rollmean(Coverage, 1000, fill = NA))) +
  theme_bw()
```

```{r}
ggplot(S26C_MAP, aes(Position, Map_value)) + 
  geom_line(aes(y=rollmean(Map_value, 1000, fill = NA))) +
  theme_bw()
```

```{r}
ggplot(S26C_MAP, aes(Position, regular)) + 
  geom_line(aes(y=rollmean(regular, 1000, fill = NA))) +
  theme_bw()
```
# look at histogram of SNP distribution

```{r}
S26C_MAP %>%
  filter(Coverage > 25) %>%
  filter(Map_value <= 1) %>%
  mutate(SNP_percent = round(Ref_cov/(Ref_cov + Aa + Gg + Cc + Tt)*100),digits = 1) %>%
  filter(SNP_percent < 99) %>%
  ggplot(aes(SNP_percent)) + 
  geom_histogram(binwidth=1) 
```
 Took the >99-100% out as they are by far the major category.  This shows the distributions around 0 and 1 due to random accumulation of error.  Are the SNPs in the 50% range caused by duplicated genes or they real medium abundance genes?

```{r}
ggplot(data=chol, aes(chol$AGE)) + 
  geom_histogram()
```

# filter potental minor alleles

```{r}
potential_true_minors <- S26C_MAP %>%
  filter(regular == 1) %>%
  filter(Coverage > 100) %>%
  filter(minor_counts > 5) %>%
  filter((Ref_cov) > (Coverage/2))
```

# filter potental true SNPs

```{r}
potential_true_SNPs <- S26C_MAP %>%
  filter(regular == 1) %>%
  filter(Coverage > 100) %>%
  filter(minor_counts > (Coverage * 0.9))
```

